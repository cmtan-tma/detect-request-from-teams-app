<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <!-- Microsoft Teams JavaScript API (via CDN) -->
  <script src="https://statics.teams.microsoft.com/sdk/v1.5.2/js/MicrosoftTeams.min.js"
    crossorigin="anonymous"></script>
  <title>Send Cookie From Teams App</title>
</head>

<body>
  <main>
    <h3>Where is this?</h3>
    <div id="in-teams">
      In Teams App: No
    </div>
    <h3>Cookie received from Server: </h3>
    <div id="cookie-response">
      There is no cookie
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js"></script>
  <script>

    microsoftTeams.initialize()

    const inTeams = document.getElementById("in-teams")
    const cookieRespone = document.getElementById("cookie-response")

    const sendCookie = async () => {
      const res = await fetch('/api/teams', {
        method: 'GET',
        credentials: "include"
      })

      if (res.ok) {
        const result = await res.json();
        inTeams.innerHTML = "In Teams App: Yes"
        cookieRespone.innerHTML = JSON.stringify(result);
      }
    }

    const setCookie = () => {
      // Get Context
      microsoftTeams.getContext((context) => {
        document.cookie = "in_teams=true;SameSite=None;Secure"
        inTeams.innerHTML = "inTeams=true";

        sendCookie();
      })
    }

    setCookie();

  </script>
</body>

</html>